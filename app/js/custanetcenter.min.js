/*! custanet 2014-06-25 */
$(function(){function a(a,b,c){var d=location.pathname,e=new Array;e=d.split("/"),""!=e[e.length-1]&&(e[e.length-1]="",d=e.join("/"));var f=(new Date).getTime(),g=new Date(f+864e5*c),h=g.toUTCString(),i="";i+=a+"="+escape(b),i+="; path="+d,i+=c?"; expires="+h+"; ":"; ",document.cookie=i}var b=$("#displayCount").val(),c=function(a){var b="";if(ccnsLen/a>1){for(var c=0,d=ccnsLen/a;d>c;c++)b=b+'<li class="page" data-page="'+(c+1)+'"><span>'+(c+1)+"</span></li>";$(".pagination").html(b)}};c(b);var e=function(a){var c=(a-1)*b,d=a*b;$("#custanetTable tbody tr").hide().slice(c,d).show(),$(".pagination li").removeClass("active"),$("li[data-page="+a+"]").addClass("active"),$("#ppn,#npn").remove(),ccnsLen>0&&a!=Math.ceil(ccnsLen/b)&&$(".pagination").append('<li id="npn"><span>&raquo;</span></li>'),1!=a&&$(".pagination").prepend('<li id="ppn"><span>&laquo;</span></li>')};if(e(1),$(document).on("click",".page",function(){var a=$(this).data("page");e(a)}),$(document).on("click","#ppn",function(){var a=$(".active").data("page")-1;e(a)}),$(document).on("click","#npn",function(){var a=$(".active").data("page")+1;e(a)}),$("#displayCount").change(function(){b=$("#displayCount").val(),e(1)}),b>=ccnsLen)$("ul.pagination").hide();else for(var f=1;f<Math.floor(ccnsLen/b);f++)$("fpn").after("<li><span>"+(f+1)+"</span></li>");$("#request-btn").click(function(){var a=function(){$("#email").val(""),$("#friendrequestsended").hide(3e3),$("#request-btn").attr("disabled",!1)};$("#request-btn").attr("disabled",!0),$("#friendrequestsended").text("friend request sended").show();var b=[{name:"email",value:$("#email").val()}];$.ajax({url:"/request",type:"post",data:b}).success(a)}),$("input.friend-check").change(function(){$("input.friend-check:checked").size()>0?$("#delete-btn").show():$("#delete-btn").hide()});var g=function(a){var b="";a=JSON.parse(a);for(d in a)b+='<label class="checkbox"><input class="friend-check" value="'+a[d].id+'" type="checkbox">'+a[d].nam+"</label>",$("input.invitation[value='"+a[d].id+"']").parent("label").remove();0==$("input.invitation").size()&&$("#left-pannel-invitation").remove(),$("#left-pannel-friends").html(b)};$("#invite-btn").click(function(){var a=function(){$("#invite-btn").attr("disabled",!1),$("#invitebtnmsg").text("error").hide(3e3)},b=function(a){$("#invite-btn").attr("disabled",!1),$("#invitebtnmsg").hide(3e3),g(a)};$("#invite-btn").attr("disabled",!0),$("#invitebtnmsg").text("Invited").show();var c=[];$("input.invitation:checked").each(function(){c.push({name:"fid",value:$(this).val()})}),$.ajax({url:"/invite",type:"post",data:c}).success(b).error(a)}),$("#delete-btn").click(function(){var a=function(a){g(a)},b=[];$("input.friend-check:checked").each(function(){b.push({name:"fid",value:$(this).val()})}),$.ajax({url:"/delete",type:"post",data:b}).success(a)}),$("#allcnts").click(function(){$(this).is(":checked")?($("#custanetTable tbody td input:visible").prop("checked",!0),$("#delete-cn-btn").removeAttr("disabled")):($("#custanetTable tbody td input:visible").prop("checked",!1),$("#delete-cn-btn").attr("disabled","disabled"))}),$("[name=custanet-list]").change(function(){0==$("[name=custanet-list]:checked").size()?$("#delete-cn-btn").attr("disabled","disabled"):$("#delete-cn-btn").removeAttr("disabled")}),$("#delete-cn-btn").click(function(){var a=function(a){a=JSON.parse(a);for(var b=0,c=a.length;c>b;b++)for(var d=0,e=ccns.length;e>d;d++)ccns[d].key==a[b]&&(ccns.splice(d,1),d=e+1);var f=angular.element($("#main-pannel")).scope();f.$apply()},b=[];$("[name=custanet-list]:checked").each(function(){b.push({name:"cid",value:$(this).val()})}),$.ajax({url:"/deleteCn",type:"post",data:b}).success(a)}),a("cuser","{{cuserKey}}",1),$("#twin").click(function(){window.open("<%=debugStr %>/twSignout","aaa")}),$("#twout").click(function(){window.open("<%=debugStr %>/twSignIn","bbb")}),$("#nickBtn").click(function(){var a=$("#nickname").val();if(""!=a){var b=[{name:"nickname",value:a}],c=function(){location.reload(!0)},d=function(){$("#nickErr").html("Please input another nickname")};return $.ajax({url:"/signin",type:"post",data:b}).success(c).error(d),!1}}),$("#nick-btn").click(function(){var a=$("#nick-txt").val();if(""!=a){var b=[{name:"action",value:"nick"},{name:"nick",value:a}],c=function(a){-1!=a.status.indexOf("ok")?location.reload(!0):$("#nick-err").html("Please input another nickname")},d=function(){$("#nick-err").html("Please input another nickname")};return $.ajax({url:debugStr+"/user",type:"post",data:b}).success(c).error(d),!1}}),$("#comment-cn-btn,#access-cn-btn").click(function(){$(this).hasClass("btn-info")?$(this).removeClass("btn-info"):$(this).addClass("btn-info");var a=[];$("#comment-cn-btn").hasClass("btn-info")&&$.extend(!0,a,ccns),$("#access-cn-btn").hasClass("btn-info")&&$.each(ccas,function(b,c){void 0==c.pub&&(c.txt="",c.pub="a",c.tag=""),a.push(c)});var b=angular.element($("#main-pannel")).scope();b.ccns=a,b.$apply()})});